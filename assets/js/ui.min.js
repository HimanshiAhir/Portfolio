$(window).on("load", function () {
  scrollToAnchor();
});

$(document).ready(function () {
  typedJS();
  $(".hamburger").click(function () {
    $(this).toggleClass("is-active");
    $(".header-wrap").toggleClass("active");
  });
  $(window).resize(function () {
    var winWidth = $(window).width();
    if (winWidth < 991) {
      $(".head-links").click(function () {
        $(".hamburger").removeClass("is-active");
        $(".header-wrap").removeClass("active");
      });
    }
  });
  var winWidth = $(window).width();
  if (winWidth < 991) {
    $(".head-links").click(function () {
      $(".hamburger").removeClass("is-active");
      $(".header-wrap").removeClass("active");
    });
  }
});

function typedJS() {
  var $textRotate = $(".text-rotate");
  if ($textRotate.length > 0) {
    var options = {
      strings: $textRotate.attr("data-elements").split(","),
      typeSpeed: 100,
      backDelay: 3000,
      backSpeed: 50,
      loop: true,
    };
    var typed = new Typed(".text-rotate", options);
  }
}

function scrollToAnchor() {
  //getting the anchor link in the URL and deleting the `#`
  var value = window.location.hash.replace("#", "");
  if (value.length > 0) {
    var sectionAnchor = "#" + value;
    $("#main > section.active, #menu > li a").removeClass("active");
    $("#main > section" + sectionAnchor).addClass("active");
    $("#menu > li a[href$=" + value + "]").addClass("active");
  }
}

var $menuLink = $("#menu > li a, .contact-btn");
var $main = $("#main");

$menuLink.on("click", function () {
  $("#main > section.active, #menu > li a").removeClass("active");
  $(this).addClass("active");
  var $valuePaaser = $(this).attr("href");
  $main.children($valuePaaser).addClass("active");
});
$(".contact-btn").on("click", function () {
  $("#menu > li a[href$='#contact']").addClass("active");
});
$(".next-page").on("click", function () {
  if ($("#menu > li a.active").attr("href") !== "#contact") {
    $("#menu > li a.active").each(function () {
      $(this)
        .parents("li")
        .next("li")
        .children("a")
        .each(function () {
          $(this).addClass("active");
          var $id = $(this).attr("href");
          $("#main > section.active").removeClass("active");
          $main.children($id).addClass("active");
        });
      $(this).removeClass("active");
    });
  } else {
    $("#main > section.active, #menu > li a.active").removeClass("active");
    $("#menu > li:first-child a, main > section:first-child").addClass(
      "active"
    );
  }
});

$(".prev-page").on("click", function () {
  if ($("#menu > li a.active").attr("href") !== "#home") {
    $("#menu > li a.active").each(function () {
      $(this)
        .parents("li")
        .prev("li")
        .children("a")
        .each(function () {
          $(this).addClass("active");
          var $id = $(this).attr("href");
          $("main > section.active").removeClass("active");
          $main.children($id).addClass("active");
        });
      $(this).removeClass("active");
    });
  } else {
    $("main > section.active, #menu > li a.active").removeClass("active");
    $("#menu > li:last-child a, main > section:last-child").addClass("active");
  }
});

var swiper = new Swiper(".mySwiper", {
  slidesPerView: 1,
  spaceBetween: 30,
  grabCursor: true,
  loop: true,
  speed: 500,
  pagination: {
    el: ".swiper-pagination",
    dynamicBullets: true,
  },
  navigation: {
    nextEl: ".client-slide-right",
    prevEl: ".client-slide-left",
  },
  breakpoints: {
    640: {
      slidesPerView: 1,
    },
    768: {
      slidesPerView: 2,
      spaceBetween: 30,
    },
    1024: {
      slidesPerView: 3,
      spaceBetween: 30,
    },
  },
});

// external js: isotope.pkgd.js

// init Isotope
var $grid = $(".portfolio-wrap").isotope({
  itemSelector: ".portfolio-item",
});

// store filter for each group
var filters = {};

$(".portfolio-filter").on("click", ".work-links", function (event) {
  var $button = $(event.currentTarget);
  // get group key
  var $buttonGroup = $button.parents(".portfolio-filter");
  // set filter for group
  filters = $button.attr("data-filter");
  // combine filters
  var filterValue = concatValues(filters);
  // set filter for Isotope
  $grid.isotope({ filter: filterValue });
});

// change is-checked class on buttons
$(".portfolio-filter").each(function (i, buttonGroup) {
  var $buttonGroup = $(buttonGroup);
  $buttonGroup.on("click", ".work-links", function (event) {
    $buttonGroup.find(".active").removeClass("active");
    var $button = $(event.currentTarget);
    $button.addClass("active");
  });
});

// flatten object by concatting values
function concatValues(obj) {
  var value = "";
  for (var prop in obj) {
    value += obj[prop];
  }
  return value;
}

// Isotop Front Page 
// external js: isotope.pkgd.js, imagesloaded.pkgd.js
$( window ).bind("load", function() {
  // init Isotope
  var $grid = $('.grid').isotope({
  itemSelector: '.grid-item',
  percentPosition: true,
  masonry: {
  columnWidth: '.grid-sizer'
  }
  });
  // layout Isotope after each image loads
  // $grid.imagesLoaded().progress( function() {
  // $grid.isotope('layout');
  // });
  
  // store filter for each group
  var filters = {};

  $('#filters').on( 'click', '.button', function() {
    var $this = $(this);
    // get group key
    var $buttonGroup = $this.parents('.button-group');
    var filterGroup = $buttonGroup.attr('data-filter-group');
    // set filter for group
    filters[ filterGroup ] = $this.attr('data-filter');
    // combine filters
    var filterValue = concatValues( filters );
    // set filter for Isotope
    $grid.isotope({ filter: filterValue });
  });

  // change is-checked class on buttons
  $('.button-group').each( function( i, buttonGroup ) {
    var $buttonGroup = $( buttonGroup );
    $buttonGroup.on( 'click', 'button', function() {
      $buttonGroup.find('.is-checked').removeClass('is-checked');
      $( this ).addClass('is-checked');
    });
  });

  // flatten object by concatting values
  function concatValues( obj ) {
    var value = '';
    for ( var prop in obj ) {
      value += obj[ prop ];
    }
    return value;
  }

  }); //fin load function    

  //   Form Validation 

const usernameEl = document.querySelector('#username');
const emailEl = document.querySelector('#email');

const form = document.querySelector('#signup');


const checkUsername = () => {

let valid = false;

const min = 3,
max = 25;

const username = usernameEl.value.trim();

if (!isRequired(username)) {
showError(usernameEl, 'Username cannot be blank.');
} else if (!isBetween(username.length, min, max)) {
showError(usernameEl, `Username must be between ${min} and ${max} characters.`)
} else {
showSuccess(usernameEl);
valid = true;
}
return valid;
};


const checkEmail = () => {
let valid = false;
const email = emailEl.value.trim();
if (!isRequired(email)) {
showError(emailEl, 'Email cannot be blank.');
} else if (!isEmailValid(email)) {
showError(emailEl, 'Email is not valid.')
} else {
showSuccess(emailEl);
valid = true;
}
return valid;
};




const isEmailValid = (email) => {
const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
return re.test(email);
};


const isRequired = value => value === '' ? false : true;
const isBetween = (length, min, max) => length < min || length > max ? false : true;


const showError = (input, message) => {
// get the form-field element
const formField = input.parentElement;
// add the error class
formField.classList.remove('success');
formField.classList.add('error');

// show the error message
const error = formField.querySelector('small');
error.textContent = message;
};

const showSuccess = (input) => {
// get the form-field element
const formField = input.parentElement;

// remove the error class
formField.classList.remove('error');
formField.classList.add('success');

// hide the error message
const error = formField.querySelector('small');
error.textContent = '';
}


form.addEventListener('submit', function (e) {
    
e.preventDefault();

// validate fields
let isUsernameValid = checkUsername(),
isEmailValid = checkEmail();

let isFormValid = isUsernameValid &&
isEmailValid;

if (isFormValid) {

}
});


const debounce = (fn, delay = 500) => {
let timeoutId;
return (...args) => {
// cancel the previous timer
if (timeoutId) {
    clearTimeout(timeoutId);
}
// setup a new timer
timeoutId = setTimeout(() => {
    fn.apply(null, args)
}, delay);
};
};

form.addEventListener('input', debounce(function (e) {
switch (e.target.id) {
case 'username':
    checkUsername();
    break;
case 'email':
    checkEmail();
    break;
}
}));